extends layout 

block content 
  h1.admin_con_title= title

  .admin_tool_wrap.clearfix 
    a(href="/admin/"+url+"/list") 리스트
    if (url==='notice' || url==='event' || url==='faq')
      a(href=`/admin/${url}/create`) 
       i.fa.fa-pencil(aria-hidden='true')
       | 글 작성
      a(href=`/admin/${url}/${blog._id}/update`) 
       i.fa.fa-pencil-square-o(aria-hidden='true')
       | 수정
      a(href=`/admin/${url}/${blog._id}/delete`) 
        i.fa.fa-trash-o(aria-hidden='true')
        | 삭제

  .admin_blog_wrap
    h3 제목 : #{blog.title}
    h4 내용 : !{blog.content}
    p #{blog.reg_date}
  

  if (url==='qna')

    button(onclick=`createItem('${blog._id}', 0)`) create

    h3 comments

    each blog_comment in blog_comments 
      div(id="item-" + blog_comment._id)
        p(id="content-" + blog_comment._id) #{blog_comment.content} 
        if (blog_comment.user)
          i - #{blog_comment.user.username}
        p
          button(onclick=`createItem('${blog_comment.parent}', '${blog_comment._id}')`) update
          button(onclick=`deleteItem('${blog_comment._id}')`) delete
          button(onclick=`createItem('${blog_comment._id}', 0)`) add
        div(style="margin-left:25px")
          each comment in blog_comment.comment
            div(id="item-" + comment._id)
              p(id="content-" + comment._id) #{comment.content} 
              if (blog_comment.user)
                i - #{comment.user.username}
              p
                button(onclick=`createItem('${comment.parent}', '${comment._id}')`) update
                button(onclick=`deleteItem('${comment._id}')`) delete
                button(onclick=`createItem('${blog_comment._id}', 0)`) add
        br

    hr

    h3 comment form

    form(action="/admin/qna/comment/create", method="POST") 
      div.form-group
        label(for="") parent
        input(type="text", id="parent" name="parent", value="")
      div.form-group
        label(for="") id
        input(type="text", id="id" name="id", value="")
      div.form-group
        label(for="") 
        textarea(name="content")
      button(type="submit") confirm 


    script.
      var form = document.querySelector('form')

      function createItem(parent, id) {
        document.querySelector('#parent').value = parent
        document.querySelector('#id').value = id
        var content = document.querySelector('#content-' + id) ? document.querySelector('#content-' + id).textContent : ''
        document.querySelector('textarea').textContent = content
      }

      async function deleteItem(id) {
        var res = confirm('y/n')
        if (res===false) {
          return console.log('false')
        }

        var results = await fetch('/admin/qna/comment/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: 'id=' + id
        }).then(res => res.text())

        document.getElementById('item-' + id).style.display = 'none'
      }
