extends layout 
block header 
  include back_header.pug
block content 
  h1= title

  //- pre= estimate_request

  h2 ## #{estimate_request.topic.name}
  hr

  -var x = 1
  while (x < 11)
    -var y = x++
    if (estimate_request[`field${y}`].length>0)
      h3 # #{estimate_request[`field${y}`][0].item.name}
      each something in estimate_request[`field${y}`]
        p= something.name 
        if (estimate_request.estimate_text[0] && estimate_request.estimate_text[0].item.toString()===something.item._id.toString())
          p #{estimate_request.estimate_text[0].text}
      hr

  h3 # somethign to say 
  p= estimate_request.content

  form(action="", method="POST") 
    table 
      tbody#itemTable
        tr 
          th item 
          th cost 
          th note 
        tr#itemRow 
          td 
            input(type="text", name="item")
          td
            input(type="number", name="cost")
          td
            input(type="text", name="note")
        tr 
          td 
            input(type="text", name="item")
          td
            input(type="number", name="cost")
          td
            input(type="text", name="note")
        tr 
          td 
            input(type="text", name="item")
          td
            input(type="number", name="cost")
          td
            input(type="text", name="note")
          
    p
      button(type="submit") confirm
    p   
      button#addItem add

    hr

  p 
    a(href="/estimate/received/list") list

 
    script.
      var itemTable = document.getElementById('itemTable')
      var itemRow = document.getElementById('itemRow')
      var addItem = document.getElementById('addItem')

      addItem.addEventListener('click', function (e) {
        e.preventDefault()
        var newItem = itemRow.cloneNode(true)
        for (td of newItem.children) {
          td.firstElementChild.value = ''
          td.firstElementChild.required=false
        }
        itemTable.appendChild(newItem)
      })






